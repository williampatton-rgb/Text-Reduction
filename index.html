<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Simplifier for Students (Gemini Powered)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .container {
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
        }
        textarea {
            resize: vertical;
            height: 150px;
        }
        .api-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .api-container input[type="password"], .api-container input[type="text"] {
            flex-grow: 1;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .btn-secondary {
            background-color: #2ecc71;
        }
        .btn-secondary:hover {
            background-color: #27ae60;
        }
        .status {
            margin-top: 10px;
            font-style: italic;
            color: #7f8c8d;
        }
    </style>
</head>
<body>

    <h1>Article Simplifier <br><span style="font-size: 0.6em; color: #7f8c8d;">Powered by Gemini 2.5 Flash</span></h1>
    
    <div class="container">
        <div class="form-group">
            <label for="apiKey">Gemini API Key:</label>
            <div class="api-container">
                <input type="password" id="apiKey" placeholder="AIzaSy...">
                <label style="font-weight: normal; margin: 0; display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="toggleKey" onclick="toggleApiKeyVisibility()"> Show
                </label>
            </div>
        </div>

        <div class="form-group">
            <label for="inputText">Paste Article Here:</label>
            <textarea id="inputText" placeholder="Paste the text you want to simplify..."></textarea>
        </div>

        <button id="simplifyBtn" onclick="processText()">Simplify Article</button>
        <div id="statusText" class="status"></div>

        <div class="form-group" style="margin-top: 30px;">
            <label for="outputText">Simplified Result:</label>
            <textarea id="outputText" readonly placeholder="Your simplified bullet points will appear here..."></textarea>
        </div>

        <div class="actions">
            <button class="btn-secondary" id="copyBtn" onclick="copyText()" disabled>Copy Text</button>
            <button class="btn-secondary" id="downloadBtn" onclick="downloadWord()" disabled>Download as Word (.doc)</button>
        </div>
    </div>

    <script>
        // The specific prompt provided by the user
        const systemPrompt = `Please simplify this article in Bullet Points. Do not add pictures. Do not add text. Do not add any additional information. Do not delete any information. Only simplify and shorten the language. Make it as short and simple as you can while retaining all essential facts. Simplify it so that a 5th grade non-native speaker could understand it.`;

        function toggleApiKeyVisibility() {
            const apiKeyInput = document.getElementById("apiKey");
            if (apiKeyInput.type === "password") {
                apiKeyInput.type = "text";
            } else {
                apiKeyInput.type = "password";
            }
        }

        async function processText() {
            const apiKey = document.getElementById("apiKey").value.trim();
            const inputText = document.getElementById("inputText").value.trim();
            const statusText = document.getElementById("statusText");
            const simplifyBtn = document.getElementById("simplifyBtn");

            if (!apiKey) {
                alert("Please enter your Gemini API Key.");
                return;
            }
            if (!inputText) {
                alert("Please paste an article to simplify.");
                return;
            }

            statusText.innerText = "Processing... this may take a few seconds.";
            simplifyBtn.disabled = true;

            try {
                // Using the Gemini 2.5 Flash endpoint
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
                
                // Formatted specifically for the Gemini REST API
                const requestBody = {
                    system_instruction: {
                        parts: [
                            { text: systemPrompt }
                        ]
                    },
                    contents: [
                        {
                            parts: [
                                { text: `Here is the article:\n\n${inputText}` }
                            ]
                        }
                    ],
                    generationConfig: {
                        temperature: 0.3 // Low temperature for factual, consistent formatting
                    }
                };

                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                
                // Navigate Gemini's specific response structure to extract the text
                let rawOutput = data.candidates[0].content.parts[0].text;

                // Enforce the 1 blank line between bullet points rule
                // Split by newlines, remove empty spaces, and join with exactly double newlines
                const formattedOutput = rawOutput
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .join('\n\n');

                document.getElementById("outputText").value = formattedOutput;
                statusText.innerText = "Done!";
                
                // Enable action buttons
                document.getElementById("copyBtn").disabled = false;
                document.getElementById("downloadBtn").disabled = false;

            } catch (error) {
                console.error(error);
                statusText.innerText = "";
                alert("An error occurred: " + error.message);
            } finally {
                simplifyBtn.disabled = false;
            }
        }

        function copyText() {
            const outputText = document.getElementById("outputText");
            outputText.select();
            outputText.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(outputText.value).then(() => {
                alert("Copied to clipboard!");
            }).catch(err => {
                alert("Failed to copy text: " + err);
            });
        }

        function downloadWord() {
            const text = document.getElementById("outputText").value;
            
            // Format the text into basic HTML so Word recognizes the spacing and bullet points
            const htmlContent = text.split('\n\n').map(paragraph => {
                return `<p style="margin-bottom: 12pt;">${paragraph}</p>`;
            }).join('');

            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Simplified Article</title></head><body>";
            const footer = "</body></html>";
            const fullHtml = header + htmlContent + footer;

            // Create a blob with the Word document MIME type
            const blob = new Blob(['\ufeff', fullHtml], {
                type: 'application/msword'
            });
            
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Simplified_Article.doc'; 
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>